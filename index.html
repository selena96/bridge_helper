<!DOCTYPE html>
<html lang="sr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bridž - Test</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      background-color: #f8f8f8;
      color: #333;
      padding: 20px;
      text-align: center;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
    }

    h1, h2 {
      margin-bottom: 20px;
    }

    button {
      margin: 10px 0;
      padding: 10px 20px;
      background-color: #007BFF;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    button:disabled {
      background-color: #ccc;
    }

    button:hover {
      background-color: #0056b3;
    }

    #category-container {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .category-btn {
      padding: 15px;
      background-color: #28a745;
      color: white;
      font-size: 18px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      position: relative;
    }

    .category-btn.easy {
      background-color: #28a745;
    }

    .category-btn.medium {
      background-color: #ffc107;
    }

    .category-btn.hard {
      background-color: #dc3545;
    }

    .score-percentage {
      position: absolute;
      right: 10px;
      font-size: 14px;
      color: #fff;
    }

    #answer-container button {
      display: block;
      width: 100%;
      margin: 10px 0;
    }

    #answer-container button.correct {
      background-color: #28a745;
    }

    #answer-container button.incorrect {
      background-color: #dc3545;
    }

    #explanation {
      margin-top: 20px;
    }

    #quiz-section, #score-section {
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Bridž - Test</h1>
    <h2>Izaberi kategoriju</h2>
    
    <!-- Categories will be loaded dynamically from JSON -->
    <div id="category-container"></div>

    <!-- Quiz section -->
    <div id="quiz-section" style="display: none;">
      <div id="question-container">
        <p id="question-text"></p>
        <button id="hint-btn">Hint</button>
        
        <div id="answer-container"></div>
        
        <div id="explanation" style="display: none;"></div>
        
        <button id="next-btn" style="display: none;">Next</button>
      </div>
    </div>
    
    <!-- Final score -->
    <div id="score-section" style="display: none;">
      <p>Your Score: <span id="final-score"></span></p>
      <button id="go-to-main-menu">Go to Main Menu</button>
    </div>
  </div>
  
  <script>
    let currentCategory = null;
    let currentQuestionIndex = 0;
    let score = 0;
    let quizData = [];
    let categoryScores = {};  // To hold category scores

    document.addEventListener('DOMContentLoaded', () => {
      loadCategories();
    });

    function loadCategories() {
      fetch('questions.json')
        .then(response => response.json())
        .then(data => {
          quizData = data.categories;
          const categoryContainer = document.getElementById('category-container');
          categoryContainer.innerHTML = '';  // Clear previous categories
          
          quizData.forEach((category, index) => {
            const button = document.createElement('button');
            button.textContent = category.name;

            // Check if category has been completed
            if (categoryScores[category.name]) {
              const percentage = (categoryScores[category.name].score / categoryScores[category.name].totalQuestions) * 100;
              button.innerHTML = `${category.name} <span class="score-percentage">${Math.round(percentage)}%</span>`;
            }
            
            button.classList.add('category-btn', category.difficulty);
            button.onclick = () => startQuiz(category, index);
            categoryContainer.appendChild(button);
          });
        });
    }

    function startQuiz(category, index) {
      currentCategory = category;
      currentQuestionIndex = 0;
      score = 0;
      document.getElementById('category-container').style.display = 'none';
      document.getElementById('quiz-section').style.display = 'block';
      showQuestion();
    }

    function showQuestion() {
      const question = currentCategory.questions[currentQuestionIndex];
      document.getElementById('question-text').textContent = question.question;
      document.getElementById('answer-container').innerHTML = '';
      question.answers.forEach(answer => {
        const button = document.createElement('button');
        button.textContent = answer.text;
        button.onclick = () => checkAnswer(button, answer);
        document.getElementById('answer-container').appendChild(button);
      });

      document.getElementById('hint-btn').onclick = () => alert(question.hint);
      document.getElementById('next-btn').style.display = 'none';
    }

    function checkAnswer(button, answer) {
      const question = currentCategory.questions[currentQuestionIndex];
      if (answer.isCorrect) {
        button.classList.add('correct');
        score++;
      } else {
        button.classList.add('incorrect');
        const correctAnswerButton = Array.from(document.getElementById('answer-container').children).find(child => child.textContent === question.answers.find(a => a.isCorrect).text);
        correctAnswerButton.classList.add('correct');
      }

      document.getElementById('explanation').textContent = question.explanation;
      document.getElementById('explanation').style.display = 'block';
      document.getElementById('next-btn').style.display = 'block';
    }

    document.getElementById('next-btn').onclick = () => {
      currentQuestionIndex++;
      if (currentQuestionIndex < currentCategory.questions.length) {
        showQuestion();
        document.getElementById('explanation').style.display = 'none';
      } else {
        endQuiz();
      }
    };

    function endQuiz() {
      // Save score to categoryScores
      categoryScores[currentCategory.name] = {
        score: score,
        totalQuestions: currentCategory.questions.length
      };

      document.getElementById('quiz-section').style.display = 'none';
      document.getElementById('score-section').style.display = 'block';
      document.getElementById('final-score').textContent = `${score} / ${currentCategory.questions.length}`;
    }

    document.getElementById('go-to-main-menu').onclick = () => {
      document.getElementById('score-section').style.display = 'none';
      document.getElementById('category-container').style.display = 'block';
      loadCategories();  // Reload categories with updated scores
    };
  </script>
</body>
</html>
